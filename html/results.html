{% extends 'base.html' %}
{% load staticfiles %}
{% block style %}
<link href="{% static 'css/output.css' %}" rel="stylesheet">
{% endblock %}
{% block content %}
<div class="navbar-header">
    <div class="container">
        <div id="menu">
            <ul id="menubar">
                <li><a href="{% url 'index' %}" target="_self"><img src="{% static 'img/logo-erasmus.png' %}" alt="" class="img-thumbnail" width="81.5 height="31.8"></a></li>
                <li><span class="menu-text" style="margin-left:10px"><a href="{% url 'triples' %}">Index your data</a></span></li>
                <li><span class="menu-text" style="margin-left:10px"><a href="{% url 'seek' %}">Upload files to SEEK</a></span></li>
                <li><span class="menu-text"><a href="{% url 'delete' %}">Delete indexed data</a></span></li>
                <li><span class="menu-text"><a href="{% url 'logout' %}">Logout</a></span></li>
            </ul>
        </div>
    </div>
</div>
<div class="container" style="margin-top:100px"></div>
<div id="title">
    <h2>{{resultid}}</h2>
</div>
<br />
<div id="wrapper">
    <div class="resultDiv" id="input" style="overflow-x:auto;">
        <h3>Input Files</h3>
        <p>
            <table class="tblresult" id="input-files">
                <span id="input-list" style="display: none">
                    {{inputs}}
                </span>
                <th>Input File</th>
                <th></th>
                {% for inputid, input in inputs.items %}
                    <tr>
                        <td>{{input}}</td>
                        <td>
                            {% if storagetype == "SEEK" %}
                                <a href="{{storage}}/data_files/{{inputid}}" target="_blank">
                                    <button class="button">View / Download</button>
                                </a>
                            {% else %}
                                <a href="{{storage}}/{{resultid}}/{{input}}">
                                    <button class="button">View / Download</button>
                                </a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </p>
    </div>
    <div class="resultDiv" id="analysis" style="overflow-x:auto;">
        <h3>Analysis Details</h3>
        <p>
            <table class="tblresult" id="analysis-info">
                <th>Galaxy file</th>
                <th>ID (workflow only)</th>
                <th>Import (history) / Download (workflow)</th>
                {% if outputs %}
                    {% for outid, outname in outputs.items %}
                        {% if ".ga" in outname %}
                            <tr>
                                <td>{{outname}}</td>
                                <td id="workflowid">{{workflowid}}</td>
                                <td>
                                    <span id="ga" style="display: none">{{storage}}/{{resultid}}/{{outid}}</span>
                                    {% if storagetype == "SEEK" %}
                                        <a href="{{storage}}/data_files/{{outid}}" target="_blank">
                                            <button class="button">View / Download</button>
                                        </a>
                                    {% else %}
                                        <a href="{{storage}}/{{resultid}}/{{outname}}">
                                            <button class="button">View / Download</button>
                                        </a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endif %}
                        {% if ".tar" in output %}
                        <tr>
                            <td id="tar">{{output}}</td>
                            <td>&nbsp;</td>
                            <td><button class="button" name="rerun" onclick="import_history()">Import History</button></td>
                        </tr>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <tr>
                        <td>No workflow used.</td>
                        <td id="workflowid">{{workflowid}}</td>
                    </tr>
                {% endif %}
            </table>
            <table class="tblresult" id="analysis-info">
                <th>Workflow steps</th>
                {% if workflow %}
                    {% for step in workflow %}
                        <tr>
                            <td>{{step.name}}</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td>No workflow used.</td>
                    </tr>
                {% endif %}
            </table>
        </p>
        <button class="button" name="rerun" onclick="rerun_analysis()">Run Again</button>
        <br>
        <br>
        <div id="running" style="display: none" align="center">
            <img id="loadingImage" src="{% static 'img/loading.gif' %}" width="375" height="187.5">
        </div>
        <div id="finished" style="display:none" align="center">
            <img id="checkImage" src="{% static 'img/check.png' %}" width="125" height="125">
        </div>
        <div id="error" style="display:none" align="center">
            <img id="errorImage" src="{% static 'img/error.png' %}" width="125" height="125">
            <br />
            <p id="errormessage">
                Oops...wait a few seconds or reload the page to try again.
            </p>
        </div>
    </div>
    <div class="resultDiv" id="output" style="overflow-x:auto;">
        <h3>Output Files</h3>
        <p>
        <table class="tblresult" id="output-files">
            <th>Output File</th>
            <th></th>
            {% if outputs  %}
                {% for outid, outname in outputs.items %}
                    {% if ".ga" not in outname %}
                        <tr>
                            <td>{{outname}}</td>
                            <td>
                                {% if storagetype == "SEEK" %}
                                    <a href="{{storage}}/data_files/{{outid}}" target="_blank">
                                        <button class="button">View / Download</button>
                                    </a>
                                {% else %}
                                    <a href="{{storage}}/{{resultid}}/{{outname}}">
                                        <button class="button">View / Download</button>
                                    </a>
                                {% endif %}
                            </td>
                        </tr>
                    {% endif %}
                {% endfor %}
            {% else %}
                <tr><td>No output files.</td></tr>
            {% endif %}
        </table>
        </p>
    </div>
</div>
<br />
<div id="footer">
    <div class="container">
        <br />
        <br />
        <p class="muted credit">
        </p>
    </div>
</div>
{% endblock %}